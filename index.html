<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>75 Mastery Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase Compat SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #020617; /* slate-950 */
        }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes pulse-orange {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading-pulse { animation: pulse-orange 2s infinite; }
    </style>
</head>
<body class="text-slate-100">
    <div id="root">
        <div class="min-h-screen flex flex-col items-center justify-center space-y-4 text-center p-6">
            <div class="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-orange-500 font-black uppercase tracking-widest text-xs tracking-[0.2em]">Syncing Mastery...</p>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- MASTER CONFIGURATION ---
        const MANUAL_CONFIG = {
            apiKey: "AIzaSyD631oq7NL_6eX_d0_MM2TR0ebVNoo-844",
            authDomain: "my75mastery.firebaseapp.com",
            projectId: "my75mastery",
            storageBucket: "my75mastery.firebasestorage.app",
            messagingSenderId: "610595506034",
            appId: "1:610595506034:web:5d5ef97931285065537feb"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(MANUAL_CONFIG);
        }
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = '75-day-mastery-v5';

        const Icon = ({ name, className = "w-5 h-5" }) => {
            useEffect(() => { if (window.lucide) lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className}></i>;
        };

        const WeightChart = ({ data }) => {
            if (!data || data.length < 2) {
                return (
                    <div className="h-32 flex items-center justify-center text-slate-600 text-xs italic border border-slate-800 rounded-2xl bg-slate-900/50">
                        Trend appears after multiple logs...
                    </div>
                );
            }
            const weights = data.map(d => d.weight);
            const minW = Math.min(...weights) - 2;
            const maxW = Math.max(...weights) + 2;
            const range = maxW - minW || 1;
            const width = 300;
            const height = 100;
            const points = data.map((d, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((d.weight - minW) / range) * height;
                return `${x},${y}`;
            }).join(' ');
            return (
                <div className="mt-4 p-4 bg-slate-950 rounded-2xl border border-slate-800">
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-32 overflow-visible">
                        <polyline fill="none" stroke="url(#gradient)" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" points={points} className="drop-shadow-[0_0_8px_rgba(249,115,22,0.4)]" />
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" stopColor="#f97316" /><stop offset="100%" stopColor="#ec4899" />
                            </linearGradient>
                        </defs>
                        {data.map((d, i) => (
                            <circle key={i} cx={(i / (data.length - 1)) * width} cy={height - ((d.weight - minW) / range) * height} r="3" className="fill-white" />
                        ))}
                    </svg>
                </div>
            );
        };

        function App() {
            const fileInputRef = useRef(null);

            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('today');
            const [currentDayIndex, setCurrentDayIndex] = useState(0);
            const [daysData, setDaysData] = useState({});
            const [isUploading, setIsUploading] = useState(false);
            const [newWeight, setNewWeight] = useState('');
            const [dbError, setDbError] = useState(null);

            const [appPhase, setAppPhase] = useState('auth');
            const [activeProfileId, setActiveProfileId] = useState(null);
            const [usernameInput, setUsernameInput] = useState('');
            const [passwordInput, setPasswordInput] = useState('');
            const [authStatus, setAuthStatus] = useState({ message: '', type: '' });

            const [profile, setProfile] = useState({
                programType: 'hard_classic',
                startDate: new Date().toISOString().split('T')[0],
                dietDescription: '',
                intentions: '',
                isConfigured: false,
                targetWaterOz: 128,
                workoutCount: 2,
                workoutMins: 45,
                outdoorRequired: true,
                consumptionType: 'reading',
                consumptionGoal: 10,
                photoRequired: true,
                photoTitle: 'Progress Photo',
                alcoholRequired: true,
                alcoholLimit: 0,
                startWeight: '',
                currentWeight: '',
                measurements: { neck: '', chest: '', waist: '', arms: '', thighs: '', calves: '' }
            });

            // --- DERIVED CALCULATIONS ---
            
            const checkDayComplete = (dayInfo) => {
                if (!dayInfo) return false;
                const t = dayInfo.tasks || {};
                const waterMet = (dayInfo.waterOz || 0) >= (profile.targetWaterOz || 128);
                const w1 = t.workout1 === true;
                const w2 = profile.workoutCount === 2 ? t.workout2 === true : true;
                const diet = t.diet === true;
                const reading = t.consumption === true;
                const photo = profile.photoRequired ? t.photo === true : true;
                const alcohol = profile.alcoholRequired ? t.alcohol === true : true;
                return waterMet && w1 && w2 && diet && reading && photo && alcohol;
            };

            const totalsData = useMemo(() => {
                let totalMins = 0; let completedCount = 0;
                Object.values(daysData).forEach(day => {
                    const mins = (parseInt(day.workout1_mins || 0) + (parseInt(day.workout1_hrs || 0) * 60)) + (parseInt(day.workout2_mins || 0) + (parseInt(day.workout2_hrs || 0) * 60));
                    totalMins += mins;
                    if (checkDayComplete(day)) completedCount++;
                });
                const weightLost = (profile.startWeight && profile.currentWeight) ? (parseFloat(profile.startWeight) - parseFloat(profile.currentWeight)).toFixed(1) : '0.0';
                return { hours: Math.floor(totalMins / 60), mins: totalMins % 60, completedDays: completedCount, weightLost };
            }, [daysData, profile]);

            const progressPct = Math.round((totalsData.completedDays / 75) * 100);

            // --- FIREBASE EFFECTS ---

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (u) => {
                    if (!u) {
                        try { await auth.signInAnonymously(); } catch(e) { setDbError("Connection failed."); }
                    } else {
                        setUser(u);
                        try {
                            const linkRef = db.collection('artifacts').doc(appId).collection('users').doc(u.uid).collection('profile').doc('session_link');
                            const linkSnap = await linkRef.get();
                            if (linkSnap.exists && linkSnap.data().activeProfileId) {
                                setActiveProfileId(linkSnap.data().activeProfileId);
                            } else {
                                setAppPhase('auth');
                                setLoading(false);
                            }
                        } catch (e) {
                            setDbError("Database Denied. Check Firestore Rules.");
                            setLoading(false);
                        }
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user || !activeProfileId) return;

                const profileRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(activeProfileId);
                const unsubscribeProfile = profileRef.onSnapshot((docSnap) => {
                    if (docSnap.exists) {
                        const data = docSnap.data();
                        setProfile(prev => ({ ...prev, ...data }));
                        setAppPhase(data.isConfigured ? 'dashboard' : 'setup');
                        const start = new Date(data.startDate || new Date());
                        const diff = Math.floor((new Date() - start) / (1000 * 60 * 60 * 24));
                        setCurrentDayIndex(Math.max(0, Math.min(74, diff)));
                    } else {
                        setAppPhase('setup');
                    }
                    setLoading(false);
                }, (err) => { setDbError("Access Locked. Check Firestore Rules."); });

                const daysCol = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('days');
                const unsubscribeDays = daysCol.onSnapshot((snapshot) => {
                    const data = {};
                    snapshot.forEach(d => {
                        const dData = d.data();
                        if (dData.owner === activeProfileId) {
                            const parts = d.id.split('_');
                            data[parts[parts.length - 1]] = dData;
                        }
                    });
                    setDaysData(data);
                });

                return () => { unsubscribeProfile(); unsubscribeDays(); };
            }, [user, activeProfileId]);

            // Handlers
            const handleProfileAuth = async () => {
                const uInput = usernameInput.trim().toLowerCase();
                const pInput = passwordInput.trim();
                if (!uInput || !pInput) return setAuthStatus({ message: "Username and Password required.", type: "error" });

                try {
                    const profileRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(uInput);
                    const docSnap = await profileRef.get();
                    if (docSnap.exists) {
                        if (docSnap.data().passcode === pInput) {
                            await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('profile').doc('session_link').set({ activeProfileId: uInput });
                            setActiveProfileId(uInput);
                        } else {
                            setAuthStatus({ message: "Username taken. Incorrect password.", type: "error" });
                        }
                    } else {
                        const newP = { ...profile, passcode: pInput, isConfigured: false, startDate: new Date().toISOString().split('T')[0] };
                        await profileRef.set(newP);
                        await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('profile').doc('session_link').set({ activeProfileId: uInput });
                        setAppPhase('setup');
                        setActiveProfileId(uInput);
                    }
                } catch (e) { setAuthStatus({ message: "Cloud connection failed.", type: "error" }); }
            };

            const applyProgramPreset = async (type) => {
                let updates = { programType: type };
                if (type === 'hard_classic') {
                    updates = { ...updates, workoutCount: 2, workoutMins: 45, outdoorRequired: true, targetWaterOz: 128, consumptionType: 'reading', consumptionGoal: 10, dietRequired: true, photoRequired: true, photoTitle: 'Progress Photo', alcoholRequired: true, alcoholLimit: 0 };
                } else if (type === 'medium') {
                    updates = { ...updates, workoutCount: 1, workoutMins: 45, outdoorRequired: false, targetWaterOz: 128, consumptionType: 'reading', consumptionGoal: 10, dietRequired: true, photoRequired: true, photoTitle: 'Progress Photo', alcoholRequired: true, alcoholLimit: 0 };
                } else if (type === 'soft') {
                    updates = { ...updates, workoutCount: 1, workoutMins: 30, outdoorRequired: false, targetWaterOz: 64, consumptionType: 'reading', consumptionGoal: 5, dietRequired: true, photoRequired: false, alcoholRequired: false, alcoholLimit: 7 };
                }
                setProfile(prev => ({ ...prev, ...updates }));
            };

            const finalizeSetup = async () => {
                if (!profile.dietDescription.trim() || !profile.intentions.trim()) {
                    setAuthStatus({ message: "Fields required.", type: "error" });
                    return;
                }
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(activeProfileId).set({ ...profile, isConfigured: true }, { merge: true });
                setAppPhase('dashboard');
            };

            const handleSignOut = async () => {
                if (confirm("Logout?")) {
                    await db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('profile').doc('session_link').set({ activeProfileId: null });
                    setActiveProfileId(null);
                    setAppPhase('auth');
                    window.location.reload();
                }
            };

            const updateProfile = async (updates) => {
                if (!activeProfileId) return;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('profiles').doc(activeProfileId).set(updates, { merge: true });
            };

            const updateDayData = async (dayIdx, updates) => {
                const dayId = `${activeProfileId}_day-${dayIdx + 1}`;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('days').doc(dayId).set({
                    ...updates, owner: activeProfileId, day: dayIdx + 1
                }, { merge: true });
            };

            const handlePhotoUpload = async (e) => {
                const file = e.target.files?.[0];
                if (!file || !activeProfileId) return;
                setIsUploading(true);
                const reader = new FileReader();
                reader.onloadend = async () => {
                    const dayKey = `day-${currentDayIndex + 1}`;
                    const tasks = (daysData[dayKey] || {}).tasks || {};
                    await updateDayData(currentDayIndex, { photoData: reader.result, tasks: { ...tasks, photo: true } });
                    setIsUploading(false);
                };
                reader.readAsDataURL(file);
            };

            const removePhoto = async () => {
                if (!confirm("Remove photo?")) return;
                const dayKey = `day-${currentDayIndex + 1}`;
                const tasks = (daysData[dayKey] || {}).tasks || {};
                await updateDayData(currentDayIndex, { photoData: null, tasks: { ...tasks, photo: false } });
            };

            // --- RENDERING ---

            if (dbError) return (
                <div className="min-h-screen bg-slate-950 flex items-center justify-center p-10 text-center font-sans">
                    <div className="max-w-md w-full bg-slate-900 border border-red-500/30 p-8 rounded-[2.5rem] shadow-2xl space-y-6">
                        <Icon name="alert-circle" className="w-16 h-16 text-red-500 mx-auto" />
                        <h1 className="text-xl font-black uppercase text-white leading-none">Setup Error</h1>
                        <p className="text-slate-400 text-sm leading-relaxed">{dbError}</p>
                        <button onClick={() => window.location.reload()} className="w-full bg-slate-800 p-4 rounded-2xl text-white font-black uppercase text-xs">Retry Connection</button>
                    </div>
                </div>
            );

            if (loading) return (
                <div className="flex flex-col items-center justify-center h-screen bg-slate-950 text-orange-500 uppercase font-black tracking-widest gap-4">
                    <div className="w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                    Establishing Hub...
                </div>
            );

            if (appPhase === 'auth') {
                return (
                    <div className="min-h-screen bg-slate-950 flex items-center justify-center p-6 font-sans">
                        <div className="max-w-md w-full space-y-8 animate-in fade-in duration-500">
                            <div className="text-center space-y-2">
                                <div className="inline-block p-4 bg-orange-500 rounded-3xl text-white shadow-2xl mb-4 animate-bounce"><Icon name="trophy" className="w-10 h-10" /></div>
                                <h1 className="text-4xl font-black uppercase text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-rose-600 tracking-tighter leading-none">75 Mastery</h1>
                            </div>
                            <div className="bg-slate-900 p-8 rounded-[2.5rem] border border-slate-800 shadow-2xl space-y-6 text-center">
                                <div className="space-y-4">
                                    <div className="relative text-left">
                                        <label className="text-[10px] font-black text-slate-500 uppercase ml-2 mb-1 block tracking-widest font-bold">Username</label>
                                        <Icon name="user" className="absolute left-4 top-[34px] w-5 h-5 text-slate-600" />
                                        <input type="text" className="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 pl-12 text-white outline-none focus:border-indigo-500 font-bold" placeholder="Identify yourself..." value={usernameInput} onChange={(e) => setUsernameInput(e.target.value)} />
                                    </div>
                                    <div className="relative text-left">
                                        <label className="text-[10px] font-black text-slate-500 uppercase ml-2 mb-1 block tracking-widest font-bold">Password</label>
                                        <Icon name="lock" className="absolute left-4 top-[34px] w-5 h-5 text-slate-600" />
                                        <input type="password" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 pl-12 text-white outline-none focus:border-indigo-500 font-bold" placeholder="Secret passcode..." value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} />
                                    </div>
                                </div>
                                {authStatus.message && <div className={`p-3 rounded-xl text-[10px] font-black uppercase text-center ${authStatus.type === 'error' ? 'bg-rose-500/10 text-rose-500' : 'bg-green-500/10 text-green-500'}`}>{authStatus.message}</div>}
                                <button onClick={handleProfileAuth} className="w-full bg-indigo-500 p-5 rounded-2xl text-white font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all text-sm">Login or Create Account</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (appPhase === 'setup') {
                return (
                    <div className="min-h-screen bg-slate-950 flex items-center justify-center p-6 font-sans text-center">
                        <div className="max-w-md w-full bg-slate-900 border border-slate-800 p-8 rounded-[2.5rem] shadow-2xl space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                            <Icon name="target" className="w-12 h-12 text-indigo-400 mx-auto" />
                            <h2 className="text-2xl font-black uppercase tracking-tight leading-none text-white font-bold">Initial Setup</h2>
                            <div className="space-y-6 text-left">
                                <div className="p-4 bg-slate-800/20 rounded-2xl border border-slate-800">
                                    <label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Mastery Mode</label>
                                    <select className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none font-bold" value={profile.programType} onChange={(e) => applyProgramPreset(e.target.value)}>
                                        <option value="hard_classic">75 Hard (Classic Rules)</option>
                                        <option value="medium">75 Medium</option>
                                        <option value="soft">75 Soft</option>
                                        <option value="custom">Fully Custom</option>
                                    </select>
                                </div>
                                <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest">Start Date</label><input type="date" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none font-bold" value={profile.startDate} onChange={(e) => setProfile({...profile, startDate: e.target.value})} /></div>
                                <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-bold">Diet Protocol (Required)</label><input type="text" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-orange-500 font-bold" placeholder="e.g. Keto, IF" value={profile.dietDescription} onChange={(e) => setProfile({...profile, dietDescription: e.target.value})} /></div>
                                <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-bold">The Big "Why" (Required)</label><textarea className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white h-24 italic outline-none focus:border-orange-500 font-bold" placeholder="Reason for discipline..." value={profile.intentions} onChange={(e) => setProfile({...profile, intentions: e.target.value})} /></div>
                                <button onClick={finalizeSetup} className="w-full bg-orange-500 p-5 rounded-2xl text-white font-black uppercase tracking-widest shadow-xl active:scale-95 transition-all text-sm">Commit & Launch</button>
                            </div>
                        </div>
                    </div>
                );
            }

            const currentDayKey = `day-${currentDayIndex + 1}`;
            const currentDayData = daysData[currentDayKey] || { tasks: {}, waterOz: 0, workout1_desc: '', workout2_desc: '', workout1_hrs: '', workout1_mins: '', workout2_hrs: '', workout2_mins: '', consumptionTitle: '', photoData: null, weight: '' };
            const isWaterDone = (currentDayData.waterOz || 0) >= (profile.targetWaterOz || 128);

            const w1MinsT = (parseInt(currentDayData.workout1_hrs) || 0) * 60 + (parseInt(currentDayData.workout1_mins) || 0);
            const w2MinsT = (parseInt(currentDayData.workout2_hrs) || 0) * 60 + (parseInt(currentDayData.workout2_mins) || 0);

            const pillars = [
                { id: 'workout1', label: profile.outdoorRequired ? 'Outdoor Workout' : 'Workout One', icon: <Icon name="dumbbell" />, sub: `${profile.workoutMins} Min Req`, qualifies: w1MinsT >= profile.workoutMins },
                ...(profile.workoutCount === 2 ? [{ id: 'workout2', label: 'Workout Two', icon: <Icon name="dumbbell" />, sub: `${profile.workoutMins} Min Req`, qualifies: w2MinsT >= profile.workoutMins }] : []),
                { id: 'consumption', label: profile.programType === 'hard_classic' ? 'Book Reading' : (profile.consumptionType === 'reading' ? 'Book Reading' : 'Listen to Podcast'), icon: profile.consumptionType === 'reading' ? <Icon name="book-open" /> : <Icon name="mic" />, sub: `Goal: ${profile.consumptionGoal} ${profile.consumptionType === 'reading' ? 'Pages' : 'Mins'}` },
                ...(profile.photoRequired ? [{ id: 'photo', label: profile.photoTitle || 'Visual Progress', icon: <Icon name="camera" />, sub: 'Daily Selfie' }] : []),
                { id: 'diet', label: 'Follow a Diet', icon: <Icon name="utensils" />, sub: profile.programType === 'hard_classic' ? `${profile.dietDescription || 'Standard'} â€¢ No Cheats` : (profile.dietDescription || 'No Cheats') },
                ...(profile.alcoholRequired ? [{ id: 'alcohol', label: profile.alcoholLimit === 0 ? 'No Alcohol' : 'Alcohol within Limit', icon: <Icon name="beer" />, sub: profile.alcoholLimit === 0 ? 'Zero Tolerance' : `Max ${profile.alcoholLimit} drinks / week` }] : [])
            ];

            return (
                <div className="min-h-screen bg-slate-950 text-slate-100 font-sans pb-32 animate-in fade-in duration-500">
                    <header className="p-6 bg-slate-900 border-b border-slate-800 sticky top-0 z-40 shadow-xl">
                        <div className="flex justify-between items-start mb-6">
                            <div><h1 className="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-rose-600 tracking-tighter uppercase leading-none font-black">75 Mastery</h1><p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest mt-2 flex items-center gap-1 font-bold"><Icon name="shield-check" className="w-3 h-3 text-green-500" /> Profil: {activeProfileId}</p></div>
                            <div className="text-right flex flex-col items-end font-bold"><div className="text-xs font-black text-orange-400 flex items-center gap-1 uppercase tracking-widest font-bold"><Icon name="sun" className="w-3 h-3" /> Day {currentDayIndex+1}</div></div>
                        </div>
                        <div className="relative h-3 bg-slate-800 rounded-full overflow-hidden mb-2 shadow-inner font-bold"><div className="absolute h-full bg-gradient-to-r from-orange-500 to-rose-500 transition-all duration-1000" style={{ width: `${progressPct}%` }} /></div>
                        <div className="flex justify-between text-[10px] font-black text-slate-500 uppercase tracking-tighter font-bold"><span>{progressPct}% Mastery</span><span>{totalsData.completedDays} Wins</span></div>
                    </header>

                    <nav className="flex px-4 py-2 gap-2 bg-slate-950 sticky top-[138px] z-30 shadow-2xl border-b border-slate-900 overflow-x-auto scrollbar-hide font-bold">
                        <button onClick={() => setActiveTab('today')} className={`flex-1 min-w-[90px] py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all flex flex-col items-center gap-1 ${activeTab === 'today' ? 'bg-orange-500 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-900'}`}><Icon name="calendar" /> Daily</button>
                        <button onClick={() => setActiveTab('gallery')} className={`flex-1 min-w-[90px] py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all flex flex-col items-center gap-1 ${activeTab === 'gallery' ? 'bg-orange-500 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-900'}`}><Icon name="layout-grid" /> Gallery</button>
                        <button onClick={() => setActiveTab('stats')} className={`flex-1 min-w-[90px] py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all flex flex-col items-center gap-1 ${activeTab === 'stats' ? 'bg-orange-500 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-900'}`}><Icon name="activity" /> Stats</button>
                        <button onClick={() => setActiveTab('setup')} className={`flex-1 min-w-[90px] py-3 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all flex flex-col items-center gap-1 ${activeTab === 'setup' ? 'bg-orange-500 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-900'}`}><Icon name="settings" /> Setup</button>
                    </nav>

                    <main className="p-4 max-w-lg mx-auto space-y-6">
                        {activeTab === 'today' && (
                            <>
                                {profile.intentions && <div className="p-4 bg-orange-500/5 border border-orange-500/20 rounded-2xl text-center italic text-sm text-orange-200/70 shadow-lg italic font-bold">"{profile.intentions}"</div>}
                                <div className="flex items-center justify-between bg-slate-900 p-4 rounded-2xl border border-slate-800 shadow-xl"><button onClick={() => setCurrentDayIndex(Math.max(0, currentDayIndex - 1))} className="p-2 text-slate-500 hover:text-orange-500 transition-colors"><Icon name="chevron-left" /></button><div className="text-center"><h2 className="text-xl font-black uppercase tracking-tighter text-white font-bold">DAY {currentDayIndex + 1}</h2><p className="text-[10px] text-orange-500 font-bold uppercase tracking-widest font-bold">{new Date(new Date(profile.startDate).getTime() + currentDayIndex * 86400000).toLocaleDateString('en-US', { month: 'long', day: 'numeric' })}</p></div><button onClick={() => setCurrentDayIndex(Math.min(74, currentDayIndex + 1))} className="p-2 text-slate-500 hover:text-orange-500 transition-colors"><Icon name="chevron-right" /></button></div>

                                {/* Water Tracker Improvements */}
                                <div className={`p-5 rounded-3xl border transition-all duration-500 shadow-xl ${isWaterDone ? 'bg-green-500/10 border-green-500/50' : 'bg-slate-900 border-slate-800'}`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <div className="flex items-center gap-2">
                                            <div className={`p-2 rounded-lg ${isWaterDone ? 'bg-green-500 text-white shadow-lg' : 'bg-cyan-500/20 text-cyan-400'}`}>
                                                <Icon name={isWaterDone ? "check" : "droplets"} />
                                            </div>
                                            <h3 className="font-black text-sm uppercase tracking-wider text-white font-bold">Hydration</h3>
                                            {isWaterDone && <span className="bg-green-500 text-white text-[8px] font-black px-2 py-0.5 rounded-full uppercase ml-1 animate-pulse">Goal Met</span>}
                                        </div>
                                        <div className="text-right flex items-center gap-2 font-black">
                                            <input type="number" className="bg-slate-950 border border-slate-800 px-2 py-1 rounded w-16 text-center text-white outline-none font-bold" value={currentDayData.waterOz || 0} onChange={(e) => updateDayData(currentDayIndex, { waterOz: parseInt(e.target.value) || 0 })} />
                                            <span className="text-xs text-slate-500 uppercase tracking-widest font-bold">Oz / {profile.targetWaterOz}</span>
                                        </div>
                                    </div>
                                    <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                        {[8, 16, 24, 32].map(oz => (<button key={oz} onClick={() => updateDayData(currentDayIndex, { waterOz: (currentDayData.waterOz || 0) + oz })} className="bg-slate-800 border border-slate-700 px-4 py-2 rounded-xl text-xs font-bold text-slate-300 active:bg-cyan-500 transition-all active:scale-95">+{oz}oz</button>))}
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    {pillars.map(p => {
                                        const done = currentDayData.tasks?.[p.id];
                                        
                                        // WORKOUT PILLARS
                                        if (p.id.startsWith('workout')) {
                                            const color = p.id === 'workout1' ? 'orange' : 'blue';
                                            return (
                                                <div key={p.id} className={`p-5 rounded-3xl border transition-all duration-300 ${done ? `bg-green-500/10 border-green-500/50 shadow-inner` : 'bg-slate-900 border-slate-800 shadow-xl'}`}>
                                                    <div className="flex justify-between items-start mb-4 font-bold">
                                                        <div className="flex items-center gap-2">
                                                            <div className={`p-2 rounded-lg ${done ? `bg-green-500 text-white shadow-lg` : `bg-${color}-500/20 text-${color}-500`}`}><Icon name={p.id.startsWith('workout') ? "dumbbell" : p.id} /></div>
                                                            <div><h3 className={`font-black text-sm uppercase tracking-wider ${done ? 'text-slate-100' : 'text-slate-300'}`}>{p.label}</h3><p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">{p.sub}</p></div>
                                                        </div>
                                                        <div className="flex gap-1">
                                                            <input type="number" className="w-10 bg-slate-950 border border-slate-800 rounded px-1 text-center font-bold text-white outline-none" placeholder="H" value={currentDayData[`${p.id}_hrs`] || ''} onChange={(e) => updateDayData(currentDayIndex, { [`${p.id}_hrs`]: e.target.value })} />
                                                            <span className="text-slate-600 font-bold">:</span>
                                                            <input type="number" className="w-10 bg-slate-950 border border-slate-800 rounded px-1 text-center font-bold text-white outline-none" placeholder="M" value={currentDayData[`${p.id}_mins`] || ''} onChange={(e) => updateDayData(currentDayIndex, { [`${p.id}_mins`]: e.target.value })} />
                                                        </div>
                                                    </div>
                                                    <textarea className="w-full bg-slate-800/50 border border-slate-700 rounded-xl p-3 text-sm text-slate-300 outline-none h-20 mb-3 font-bold" placeholder="Notes..." value={currentDayData[`${p.id}_desc`] || ''} onChange={(e) => updateDayData(currentDayIndex, { [`${p.id}_desc`]: e.target.value })} />
                                                    <div className="flex items-center gap-3">
                                                        <div className="flex-1">
                                                            {done ? (
                                                                <div className="w-full py-3 rounded-xl font-black text-xs uppercase border border-green-700 bg-green-500/20 text-green-400 flex items-center justify-center gap-2 font-bold"><Icon name="check-circle-2" className="w-4 h-4" /> Workout Completed</div>
                                                            ) : (
                                                                <button disabled={!p.qualifies} onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, [p.id]: true }})} className={`w-full py-3 rounded-xl font-black text-xs uppercase border transition-all font-bold ${p.qualifies ? `bg-${color}-500 border-${color}-400 text-white shadow-lg` : 'bg-slate-950 border-slate-800 text-slate-700 cursor-not-allowed'}`}>
                                                                    {p.qualifies ? 'Mark Completed' : 'Min Not Met'}
                                                                </button>
                                                            )}
                                                        </div>
                                                        {done && <button onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, [p.id]: false }})} className="p-3 bg-slate-800 border border-slate-700 rounded-xl text-slate-500 hover:text-rose-500 transition-all font-bold"><Icon name="rotate-ccw" className="w-4 h-4" /></button>}
                                                    </div>
                                                </div>
                                            );
                                        }

                                        // CONSUMPTION PILLAR
                                        if (p.id === 'consumption') return (
                                            <div key={p.id} className={`p-5 rounded-3xl border transition-all duration-300 ${done ? 'bg-green-500/10 border-green-500/50 shadow-inner font-bold' : 'bg-slate-900 border-slate-800 shadow-xl font-bold'}`}>
                                                <div className="flex items-center justify-between mb-4 font-bold">
                                                    <div className="flex items-center gap-2 font-bold">
                                                        <div className={`p-2 rounded-lg ${done ? 'bg-green-500 text-white shadow-lg' : 'bg-purple-500/20 text-purple-400'}`}>
                                                            <Icon name={profile.consumptionType === 'reading' ? "book-open" : "mic"} />
                                                        </div>
                                                        <h3 className="font-black text-sm uppercase tracking-wider text-white font-bold">{p.label}</h3>
                                                    </div>
                                                    {done ? (
                                                       <button onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, consumption: false }})} className="p-2 bg-slate-800 border border-slate-700 rounded-xl text-slate-500 hover:text-rose-500"><Icon name="rotate-ccw" className="w-4 h-4" /></button>
                                                    ) : (
                                                       <button onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, consumption: true }})} className="px-4 py-2 bg-purple-500 border border-purple-400 rounded-xl font-black text-[10px] uppercase text-white shadow-lg active:scale-95 transition-all">Mark as Completed</button>
                                                    )}
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <input type="text" className="w-full bg-slate-800/50 border border-slate-700 rounded-xl p-3 text-sm text-slate-300 outline-none focus:border-purple-500 font-bold" placeholder="Title..." value={currentDayData.consumptionTitle || ''} onChange={(e) => updateDayData(currentDayIndex, { consumptionTitle: e.target.value })} />
                                                    {done && <Icon name="check-circle-2" className="text-green-500 shrink-0 w-6 h-6" />}
                                                </div>
                                                {done && <p className="text-[9px] text-green-500/70 font-black mt-2 uppercase text-center tracking-[0.2em]">{profile.consumptionType === 'reading' ? 'READING' : 'PODCAST'} COMPLETED</p>}
                                            </div>
                                        );

                                        // PHOTO PILLAR
                                        if (p.id === 'photo') return (
                                            <div key={p.id} className={`p-5 rounded-3xl border transition-all duration-300 ${done ? 'bg-green-500/10 border-green-500/50 shadow-inner font-bold' : 'bg-slate-900 border-slate-800 shadow-xl font-bold'}`}>
                                                <div className="flex items-center justify-between mb-4 font-bold">
                                                    <div className="flex items-center gap-2 font-bold">
                                                        <div className={`p-2 rounded-lg ${done ? 'bg-green-500 text-white shadow-lg' : 'bg-pink-500/20 text-pink-500'}`}><Icon name="camera" /></div>
                                                        <h3 className="font-black text-sm uppercase tracking-wider text-white font-bold">{p.label}</h3>
                                                    </div>
                                                    {currentDayData.photoData && <button onClick={removePhoto} className="p-2 bg-red-500/10 text-red-500 rounded-lg hover:bg-red-500/20 transition-all font-bold"><Icon name="trash-2" className="w-4 h-4" /></button>}
                                                </div>
                                                <div onClick={() => !done && fileInputRef.current?.click()} className={`relative aspect-video rounded-2xl border-2 border-dashed transition-all flex flex-col items-center justify-center overflow-hidden cursor-pointer font-bold ${currentDayData.photoData ? 'border-green-500/50' : 'border-slate-800 bg-slate-800/20 hover:border-pink-500/30'}`}>
                                                    {currentDayData.photoData ? <img src={currentDayData.photoData} alt="Progress" className="w-full h-full object-cover font-bold" /> : <div className="flex flex-col items-center text-slate-500 font-bold">{isUploading ? <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500 font-bold" /> : <><Icon name="upload" className="w-8 h-8 mb-2 font-bold" /><span className="text-xs font-black uppercase tracking-widest font-bold">Capture Win</span></>}</div>}
                                                    <input type="file" ref={fileInputRef} onChange={handlePhotoUpload} accept="image/*" className="hidden font-bold" />
                                                </div>
                                                {done && <p className="text-[9px] text-green-500/70 font-black mt-2 uppercase text-center tracking-[0.2em]">VISUAL LOGGED</p>}
                                            </div>
                                        );

                                        // DIET & ALCOHOL PILLARS
                                        if (p.id === 'diet' || p.id === 'alcohol') {
                                            const color = p.id === 'diet' ? 'green' : 'amber';
                                            return (
                                                <div key={p.id} className={`flex items-center p-5 rounded-3xl border transition-all font-bold ${done ? `bg-green-500/10 border-green-500/50 shadow-inner` : 'bg-slate-900 border-slate-800 shadow-xl'}`}>
                                                    <div className={`p-2 rounded-lg mr-4 font-bold ${done ? `bg-green-500 text-white shadow-md` : `bg-${color}-500/20 text-${color}-500 font-bold`}`}>
                                                        <Icon name={done ? "check" : p.id === 'diet' ? "utensils" : "beer"} />
                                                    </div>
                                                    <div className="flex-1 text-left font-bold">
                                                        <span className={`block font-black text-sm uppercase tracking-wider ${done ? 'text-green-400' : 'text-white'}`}>{p.label} {done && "Completed"}</span>
                                                        <span className="text-[10px] text-slate-500 font-bold uppercase tracking-widest font-bold">{p.sub}</span>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                       {done ? (
                                                          <div className="flex items-center gap-3">
                                                             <Icon name="check-circle-2" className="text-green-500 w-6 h-6" />
                                                             <button onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, [p.id]: false }})} className="p-2 bg-slate-800 border border-slate-700 rounded-xl text-slate-500 hover:text-rose-500 transition-all font-bold"><Icon name="rotate-ccw" className="w-4 h-4" /></button>
                                                          </div>
                                                       ) : (
                                                          <button onClick={() => updateDayData(currentDayIndex, { tasks: { ...currentDayData.tasks, [p.id]: true }})} className={`px-4 py-2 bg-slate-800 border border-slate-700 rounded-xl text-[10px] font-black uppercase text-slate-400 hover:bg-green-500 hover:text-white transition-all`}>Complete</button>
                                                       )}
                                                    </div>
                                                </div>
                                            );
                                        }
                                        return null;
                                    })}
                                </div>
                            </>
                        )}

                        {activeTab === 'gallery' && (
                            <div className="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl font-bold">
                                <div className="flex items-center justify-between mb-6 font-bold"><h3 className="text-lg font-black flex items-center gap-2 text-white font-bold font-black"><Icon name="image" className="text-pink-500 font-bold" /> Evolution Gallery</h3><span className="text-[10px] font-black text-slate-500 uppercase tracking-widest font-bold">{totalsData.completedDays} Wins</span></div>
                                <div className="grid grid-cols-3 sm:grid-cols-4 gap-3 font-bold">
                                    {Array.from({ length: 75 }).map((_, i) => {
                                        const dKey = `day-${i + 1}`;
                                        const info = daysData[dKey];
                                        const isComp = checkDayComplete(info);
                                        return <button key={i} onClick={() => { setCurrentDayIndex(i); setActiveTab('today'); }} className={`aspect-square relative rounded-xl border transition-all overflow-hidden flex flex-col items-center justify-center font-bold ${i === currentDayIndex ? 'border-orange-500 ring-2 ring-orange-500/20' : 'border-slate-800 bg-slate-800/30'}`}>{info?.photoData ? <img src={info.photoData} className="w-full h-full object-cover font-bold" /> : <div className="text-[8px] font-black text-slate-700 uppercase font-bold tracking-tighter">Day {i+1}</div>}{isComp && <div className="absolute top-1 right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900 z-10" />}</button>;
                                    })}
                                </div>
                            </div>
                        )}

                        {activeTab === 'stats' && (
                            <div className="space-y-6 font-bold">
                                <div className="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-xl overflow-hidden relative text-center font-bold">
                                    <h3 className="text-lg font-black mb-2 flex items-center justify-center gap-2 uppercase tracking-tight text-white font-black"><Icon name="activity" className="text-orange-500 font-black" /> Progress Trend</h3>
                                    <WeightChart data={weightTrendData} />
                                    <div className="grid grid-cols-2 gap-4 mt-6 font-bold">
                                        <div className="bg-slate-800/50 p-4 rounded-2xl border border-slate-700/50 text-center font-bold"><p className="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1 font-black">Weight Change</p><p className="text-2xl font-black text-green-400 font-black">-{totalsData.weightLost} LBS</p></div>
                                        <div className="bg-slate-800/50 p-4 rounded-2xl border border-slate-700/50 text-center font-bold"><p className="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-1 font-black">Total Effort</p><p className="text-2xl font-black text-cyan-400 font-black">{totalsData.hours}h {totalsData.mins}m</p></div>
                                    </div>
                                </div>
                                <div className="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-xl border-t-orange-500/20 font-bold text-center">
                                    <h3 className="text-lg font-black mb-4 flex items-center justify-center gap-2 text-white font-black"><Icon name="scale" className="text-orange-500 font-black" /> Manual Weight Log</h3>
                                    <div className="flex gap-2 font-bold">
                                        <input type="number" step="0.1" className="flex-1 bg-slate-950 border border-slate-800 p-3 rounded-xl text-white font-bold outline-none focus:border-orange-500 font-bold" placeholder="Enter weight..." value={newWeight} onChange={(e) => setNewWeight(e.target.value)} />
                                        <button onClick={() => { updateDayData(currentDayIndex, { weight: newWeight }); setNewWeight(''); }} className="bg-orange-500 text-white font-black px-6 rounded-xl text-xs uppercase tracking-widest shadow-lg font-black">Log</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'setup' && (
                            <div className="space-y-6 font-bold">
                                <div className="bg-gradient-to-br from-indigo-950 to-slate-900 p-6 rounded-3xl border border-indigo-500/30 shadow-xl relative overflow-hidden text-center font-bold">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 blur-3xl -mr-16 -mt-16 font-bold" />
                                    <div className="flex items-center justify-center gap-3 mb-6 font-bold">
                                        <div className="p-3 bg-indigo-500 rounded-2xl text-white shadow-lg font-bold"><Icon name="user" className="w-6 h-6 font-bold" /></div>
                                        <div><h3 className="text-lg font-black tracking-tight uppercase leading-none text-white font-black">Identity Manager</h3><p className="text-[9px] text-indigo-400 font-bold uppercase tracking-widest mt-1 font-bold">Cross-Device Session</p></div>
                                    </div>
                                    <div className="bg-slate-950/50 rounded-2xl p-4 border border-slate-800 mb-4 text-center font-bold">
                                        <p className="text-[9px] font-black text-slate-500 uppercase mb-2 font-black tracking-widest font-black">Username</p>
                                        <p className="text-sm font-mono text-indigo-300 break-all uppercase tracking-widest font-bold">{activeProfileId}</p>
                                    </div>
                                    <button onClick={handleSignOut} className="w-full bg-slate-800 border border-slate-700 p-4 rounded-2xl text-rose-500 font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 hover:bg-rose-500/10 transition-all font-black">
                                        <Icon name="log-out" className="w-4 h-4 font-black" /> Sign Out / Switch User
                                    </button>
                                </div>
                                <div className="bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-xl font-bold">
                                    <h3 className="text-lg font-black mb-4 flex items-center gap-2 text-orange-400 font-black"><Icon name="target" className="w-5 h-5 font-black" /> Mastery Settings</h3>
                                    <div className="space-y-6 text-left font-bold">
                                        <div className="p-4 bg-slate-800/20 rounded-2xl border border-slate-800 font-bold"><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-black">Program Preset</label><select className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none font-bold" value={profile.programType} onChange={(e) => applyProgramPreset(e.target.value)}><option value="hard_classic">75 Hard (Classic Rules)</option><option value="medium">75 Medium</option><option value="soft">75 Soft</option><option value="custom">Fully Custom</option></select></div>
                                        <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-black">Program Start Date</label><input type="date" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none font-bold" value={profile.startDate} onChange={(e) => updateProfile({ startDate: e.target.value })} /></div>
                                        <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-black">Diet Goal</label><input type="text" className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-orange-500 font-bold" placeholder="e.g. Keto" value={profile.dietDescription} onChange={(e) => updateProfile({ dietDescription: e.target.value })} /></div>
                                        <div><label className="block text-[10px] font-black text-slate-500 uppercase mb-2 tracking-widest font-black">Your Big "Why"</label><textarea className="w-full bg-slate-800 border border-slate-700 rounded-xl p-3 text-white outline-none focus:border-orange-500 h-24 italic font-bold" value={profile.intentions} onChange={(e) => updateProfile({ intentions: e.target.value })} /></div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {appPhase === 'dashboard' && (
                        <footer className="fixed bottom-0 left-0 right-0 bg-slate-900/90 backdrop-blur-xl border-t border-slate-800 px-6 py-4 flex justify-around items-center z-50 shadow-[0_-10px_20px_rgba(0,0,0,0.5)] font-bold">
                            <div className="flex items-center gap-3 font-bold">
                                <div className="p-2 bg-slate-800 rounded-full shadow-lg border border-slate-800 font-bold"><Icon name="trophy" className={totalsData.completedDays > 0 ? "text-orange-500 animate-pulse font-bold" : "text-slate-500 font-bold"} /></div>
                                <div><p className="text-[10px] font-black text-slate-500 uppercase tracking-widest font-black">Consistency</p><p className="text-lg font-black text-white font-black">{totalsData.completedDays} Wins</p></div>
                            </div>
                            <div className="text-right font-bold">
                                <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest font-black tracking-widest font-bold">Total Effort</p>
                                <p className="text-lg font-black text-cyan-400 font-bold">{totalsData.hours}h <span className="text-[10px] uppercase text-slate-500 font-bold font-black">Done</span></p>
                            </div>
                        </footer>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
